{% load static %}  
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compras Diretas - Secretaria</title>
    <link rel="stylesheet" href="{% static 'usuarios/base.css' %}">
    <link rel="stylesheet" href="{% static 'produtos/compras_diretas.css' %}"> 
</head>
<body>

    <div class="container-custom">
        <div class="page-header">
            <h2>ğŸ›’ Painel de Compras Diretas</h2>
        </div>

        {% for pedido in lista %}
        <div class="card-compra">
            <div class="card-header-compra">
                <span>
                    <strong>Escola:</strong> {{ pedido.solicitante.escola.nome_escola|default:pedido.solicitante.username }} 
                    <span>(Pedido #{{ pedido.id }})</span>
                </span>
                <span class="pedido">
                    ğŸ“… {{ pedido.data_pedido|date:"d/m/Y" }}
                </span>
            </div>

            <div class="card-body-compra">
                <p>O diretor solicitou a compra direta dos seguintes itens:</p>
                <div class="box-itens">{{ pedido.observacao_carne }}</div>

                <div class="action">
                    <a href="{% url 'marcar_carne_comprada' pedido.id %}" class="btn-action btn-marcar" 
                       onclick="return confirm('Confirmar que a compra destes itens foi realizada?');">
                        âœ… Marcar Compra Realizada
                    </a>

                    <button type="button" class="btn-action reject" 
                            onclick="abrirFormNegar('{{ pedido.id }}')">
                        âŒ Negar SolicitaÃ§Ã£o
                    </button>
                </div>

                <div id="form-negar-{{ pedido.id }}" class="display-negar">
                    <form method="POST" action="{% url 'negar_compra_direta' pedido.id %}">
                        {% csrf_token %}
                        <label><strong>Por que esta compra nÃ£o serÃ¡ realizada?</strong></label>
                        <textarea name="justificativa_secretario" rows="3" class="justificativa-label" placeholder="Ex: Item nÃ£o disponÃ­vel ou verba insuficiente..." required></textarea>
                        <div class="confirmar-negar">
                            <button type="submit" class="btn-action btn-negar">Confirmar NegaÃ§Ã£o</button>
                            <button type="button" class="btn-action btn-negar cancelar" onclick="abrirFormNegar('{{ pedido.id }}')">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="empty-state">
            <div class="pendent-panel">ğŸ‰</div>
            <h3 class="aviso">Tudo em dia!</h3>
            <p>NÃ£o hÃ¡ solicitaÃ§Ãµes de compras pendentes no momento.</p>
        </div>
        {% endfor %}

        <a href="{% url 'menu_secretario' %}" class="link-voltar">â† Voltar ao Menu</a>
    </div>

    <script>
        function abrirFormNegar(id) {
            const form = document.getElementById('form-negar-' + id);
            form.style.display = (form.style.display === 'none') ? 'block' : 'none';
        }
    </script>

</body>
</html>