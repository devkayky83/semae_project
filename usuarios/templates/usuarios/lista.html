{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usu√°rios Cadastrados | SEMAE</title>
    <link rel="stylesheet" href="{% static 'usuarios/base.css' %}">
    <link rel="stylesheet" href="{% static 'usuarios/usuarios_lista.css' %}">
</head>

<body>
    <div class="container-principal">
        <header class="cabecalho-usuarios">
            <div class="cabecalho-topo">
                <div class="titulo-secao">
                    <div class="icone-usuarios">üë•</div>
                    <div>
                        <h1>Usu√°rios Cadastrados</h1>
                    </div>
                </div>
                <a href="{% url 'criar_usuario' %}" class="botao-criar">
                    <span>‚ûï</span>
                    Criar Novo Usu√°rio
                </a>
            </div>
            <p class="descricao-secao">
                Gerencie todos os usu√°rios do sistema. Voc√™ pode adicionar, editar ou remover usu√°rios conforme necess√°rio.
            </p>
            <div class="barra-pesquisa">
                <input type="text" placeholder="Buscar por nome ou cargo..." id="campoBusca" onkeyup="filtrarUsuarios()">
            </div>
        </header>

        <main class="conteudo-tabela">
            {% if usuarios %}
            <div class="informacoes-topo">
                <div class="contador-usuarios">
                    <span>Total de usu√°rios:</span>
                    <span class="badge-total">{{ usuarios|length }}</span>
                </div>
            </div>

            <div class="tabela-wrapper">
                <table class="tabela-usuarios" id="tabelaUsuarios">
                    <thead>
                        <tr>
                            <th>Usu√°rio</th>
                            <th>Cargo</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in usuarios %}
                        <tr>
                            <td>
                                <div class="coluna-usuario">
                                    <div class="avatar-usuario">{{ u.username|slice:":1"|upper }}</div>
                                    <span class="nome-usuario">{{ u.username }}</span>
                                </div>
                            </td>
                            <td>
                                <span class="badge-cargo {% if u.cargo == 'Secret√°rio' %}secretario{% elif u.cargo == 'Diretor' %}diretor{% elif u.cargo == 'Funcion√°rio' %}funcionario{% else %}outro{% endif %}">
                                    {{ u.cargo }}
                                </span>
                            </td>
                            <td>
                                <div class="acoes-celula">
                                    <a href="{% url 'editar_usuario' u.id %}" class="botao-acao botao-editar">
                                        Editar
                                    </a>
                                    <a href="{% url 'excluir_usuario' u.id %}" class="botao-acao botao-excluir">
                                        Excluir
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="mensagem-vazia">
                <div class="icone-vazio">üë§</div>
                <h3>Nenhum usu√°rio cadastrado</h3>
                <p>Comece criando seu primeiro usu√°rio clicando no bot√£o acima.</p>
                <a href="{% url 'criar' %}" class="botao-criar">
                    <span>‚ûï</span>
                    Criar Primeiro Usu√°rio
                </a>
            </div>
            {% endif %}

            <footer class="rodape-tabela">
                <a href="{% url 'menu_secretario' %}" class="botao-voltar">
                    <span>‚Üê</span>
                    Voltar ao Menu Principal
                </a>
            </footer>
        </main>
    </div>

    <script>
        function filtrarUsuarios() {
            const input = document.getElementById('campoBusca');
            const filtro = input.value.toLowerCase();
            const tabela = document.getElementById('tabelaUsuarios');
            const linhas = tabela.getElementsByTagName('tr');

            for (let i = 1; i < linhas.length; i++) {
                const nomeUsuario = linhas[i].getElementsByClassName('nome-usuario')[0];
                const cargo = linhas[i].getElementsByClassName('badge-cargo')[0];
                
                if (nomeUsuario && cargo) {
                    const textoNome = nomeUsuario.textContent || nomeUsuario.innerText;
                    const textoCargo = cargo.textContent || cargo.innerText;
                    
                    if (textoNome.toLowerCase().indexOf(filtro) > -1 || 
                        textoCargo.toLowerCase().indexOf(filtro) > -1) {
                        linhas[i].style.display = '';
                    } else {
                        linhas[i].style.display = 'none';
                    }
                }
            }
        }
    </script>
</body>

</html>